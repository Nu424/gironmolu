# ぎろんもーる

網羅的でまんべんない議論・言語化をたすけるツール。AIが観点を示すことで、ぬけもれがない言語化を実現する


## 使い方・機能
ユーザーがテーマを入力し、ワークスペースを作成する
　このテーマに対する追加の説明を加えられるようにする(例：「厳しめな視点で検討します」とか)
　　
　　カスタムの説明は、質問生成時に使う
　　ワークスペースの設定で編集できるようにする
　最適な質問を生成するための指針なども生成する
　　潜在的になにが求められているのか・なにを言語化する必要があるか、どのようなフレームワークで議論すべきか、とか
　　　1質問1論点、Yes/Noを避ける、前提を聞く、具体例を促す…とか
　　これも、ワークスペースの設定で確認・編集できるようにする

テーマに沿って、深めるための質問(…テキストオブジェクト)を生成する
　テーマに関して深堀りができ、かつユーザーが答えやすいような質問とすることを心がける(具体的な質問とか)
テキストオブジェクトをもとに、ワークスペースを描画する
　イメージは議事録ノートのような感じのデザイン。行に質問と回答欄がある感じ
ユーザーは質問に回答を入力する
回答から再構成する：回答入力後、質問-回答を簡潔に表現するテキストを作る
　テキストオブジェクトコンポーネントに、「再構成」ボタンを設置し、それを押したときに再構成される
　プロンプト例
　　```
　　質問とそれに対する回答から、回答内容を簡潔に表現するテキストを生成してください。
　　例：
　　　Q. 好きな食べ物は？ / A. りんご → 「好きな食べ物：りんご」
　　　Q. スケジュールにおける現状の課題は？ / A. 締切まで1週間しかない、そのうち作業できる日が半分くらい → 「スケジュールの課題：締切まで1週間と短く、作業可能日も半分と限られる」
　　```
追加の質問を生成する：「回答から再構成する」「質問を追加するボタン」などをトリガーとして、質問を追加する
　(処理自体は、前述の「深めるための質問を生成する」と同じ)
　「回答から再構成する」の場合、再構成テキスト生成後に、追加の質問生成処理をおこなう
　質問生成時には、現状のワークスペースをテキスト化したものをコンテキストとして渡す(技術面で後述)
　追加の質問は、既存の質問・項目の子として追加できるようにする
　　「既存の質問の子要素として質問を追加する場合、追加先の要素の参照も記述してください」
　LLMの構造化出力を用いる
　　例
```
{
  newQuestions:[
    {
      "question": "{質問文}"
      "target": "{子要素として質問を追加する場合の、追加先の要素のテキスト}"
    },
    ...
  ]
}
```
　　targetの解釈：
　　　再構成テキストが存在しない場合→質問文がtargetテキストと最も長く部分一致するテキストオブジェクトにくっつける
　　　再構成テキストがある場合→再構成テキストがtargetテキストと最も長く部分一致するテキストオブジェクトにくっつける

## UI
ワークスペース一覧・追加画面
　テーマ・テーマに対する追加説明(オプショナル)を入力する
ワークスペース画面
　質問に答えたり、質問の回答状況(…テキストオブジェクト)が見れたりする、メインの作業画面
ワークスペース設定画面
　テーマ
　テーマに対する追加説明
　質問生成指針
　ワークスペースのエクスポート…現状のテキストをtextareaかなんかで表示する・クリップボードにコピーボタンも用意する
アプリ設定画面
　OpenRouterAPIキー、使用するモデルの入力欄
　　使用するモデルは、一般的なモデルのプルダウンメニューと、自由入力の両方に対応する


## 技術面
React(Vite)、Zustand、TailwindCSS。フロント完結
LLMによる生成は、OpenRouterAPIを使用する
　API呼び出しはフロントから直接おこなう
　APIキーはフロント側で管理(localStorage-Zustandのpersist)する

各テキストオブジェクトについて
　id、質問、回答(ユーザー入力)、再構成されたテキスト(ユーザー回答後にLLM生成)、子オブジェクトか親オブジェクトの参照　あたりを持つ
　表示上はツリー構造だが、管理は平らにおこない、参照で親子を再現、表示時にツリーを作成する

テーマごとにワークスペースとして管理する

ワークスペース全体をテキスト化する処理・関数を用意する
　エクスポート(テキスト・クリップボード)機能、質問追加時のコンテキストとして使う
　基本的に、ワークスペースのテキストオブジェクトを構造化して箇条書きしたマークダウンテキスト。
　質問-回答の場合は、「- {質問}: {回答}」、再構成テキストがあれば、「- {最高性テキスト}」とする
　例
　```
　# {テーマ}

　```

## その他の事項
質問生成指針はテキストで管理する
質問は、ユーザーが手動で追加・編集・削除できるようにする
回答はプレーンテキスト
再構成について
　再構成テキストはユーザーが編集可能
　再構成ボタンによる再構成は、毎回上書きする
追加質問の生成個数は、設定できるようにする(デフォルト：3つ)
　質問追加時、すでに議論済みの内容を生成しないよう、プロンプトに記載する
テキストオブジェクトについて、拡張性を考慮し、type属性を追加する

質問追加処理時のtargetについて
　質問追加時のコンテキストには、テキストオブジェクトのIDを記載して、それを参照するようにする(テキストの部分一致はやめる)
　targetが存在しない場合・見つからない場合は、ルートに追加する

利用シーン：挙げていただいたすべてを想定。ここに関しては一旦ふわっとしておく…
対象言語は日本語固定
ワークスペース作成直後： 質問リストも生成して初期ツリーを作る
質問作成指針：最適なフレームワークを考慮して、議論の大枠を箇条書きで5-10個提示する感じ
type：question, note, heading
並び順管理：orderで管理する。D&Dはdnd-kitを使う
手動編集：上書き確認は不要
追加質問生成：自動で挿入
重複排除：プロンプトで指示する程度。判定処理は不要
追加生成時の深さ制限：なし
LLM呼び出し：具体的な方法は別ファイルに記載。ストリーミングは不要
データ保存：localStorage(Zustandのpersist)
インポート：不要
